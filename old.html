<html>
	<head>
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
		<script>

		(function ($) {
			$.colorPicker = function (element) {
				this.element = (element instanceof $) ? element : $(element);
			};

			$.colorPicker.prototype = {
				colors: [
					[0, 75, 50, 1],
					[30, 100, 50, 1],
					[60, 80, 50, 1],
					[110, 75, 50, 1],
					[220, 90, 50, 1],
					[270, 75, 50, 1],
					[300, 75, 50, 1],
					[0, 0, 50, 1]
				],

				init: function() {
					var that = this;
					$.each([1,2,3], function(i) {
						var line = $('<div class="line line-'+i+'"></div>');
						$.each(that.colors, function(j) {
							var color = $('<div class="color col-'+j+'"></div>');
							line.append(color);
							color.click(that.moveBorderSelection);
							color.prop('line', i);
							color.prop('col', j);

							switch(i) {
								case 0:
									color.css("background-color", "hsla(" + that.colors[j][0] + "," + that.colors[j][1] + "%," + that.colors[j][2] + "%," + that.colors[j][3] + ")");
									color.click(that.selectColor0);
									break;
								case 1:
									//color.click(selectColor1);
									break;
								case 2:
									//color.click(selectColor1);
									break;
							}
						});
						that.element.append(line);
					});
					var selected = this.element.find('.line-0 .col-0');
					selected.addClass('selected');
					this.element.prop('selected', [0,0]);
					this.element.prop('selectedColor', this.colors[0]);

					this.updateColors0();
					//this.updateColors1();
				},

				moveBorderSelection: function() {
					var selectIndexRange = that.element.prop('selected');

					var selected = that.element.find('.line-'+selectIndexRange[0]+' .col-'+selectIndexRange[1]);

					// if the user clicked the 1st row
					if ($(this).prop('line') == 0) {
						selected.removeClass('selected');
					} else {

					}


					selectIndexRange = [$(this).prop('line'), $(this).prop('col')]
					that.element.prop('selected', selectIndexRange);

					$(this).addClass('selected');
				},

				updateColors0: function() {
					var selectedColor = this.element.prop('selectedColor');

					start = selectedColor[2];
					if (selectedColor[1] == 0) {
						increment = (100-selectedColor[2])/(this.colors.length-1);
					} else {
						increment = (100-selectedColor[2])/(this.colors.length);
					}

					for (var i=0;i<this.colors.length;i++) {
						var colorEl = this.element.find('.line-1 .col-'+i+'');

						var color = [selectedColor[0], 
									 selectedColor[1], 
									 start+i*increment, 
									 selectedColor[3]];

						colorEl.prop('color', color);

						var hsla = "hsla(" + color[0] + "," + color[1] + "%," + color[2] + "%," + color[3] + ")";
						colorEl.css("background-color", hsla);
					}
				},

				selectColor0: function() {
					that.element.prop('selectedColor', that.colors[$(this).prop('col')]);

					that.updateColors0();
					//updateColors1(container);

					console.log(container.prop('selectedColor'));
				}				
			}
		}(jQuery));

		$(function() {
			var a = new $.colorPicker($(".colorPicker"));
			a.init();
		});

/*
				

			function selectColor1() {
				var container = $(this).parent().parent();
				container.prop('selectedColor', $(this).prop('color'));

				console.log(container.prop('selectedColor'));
			}

			

			function updateColors1(container) {
				var selectedColor = container.prop('selectedColor');

				start = selectedColor[2];
				if (selectedColor[1] == 0) {
					increment = (selectedColor[2])/(colors.length);
				} else {
					increment = (selectedColor[2])/(colors.length+1);
				}

				for (var i=0;i<colors.length;i++) {
					var colorEl = container.find('.line-2 .col-'+i+'');

					var color = [selectedColor[0], 
								 selectedColor[1], 
								 start-(i+1)*increment, 
								 selectedColor[3]];

					colorEl.prop('color', color);

					var hsla = "hsla(" + color[0] + "," + color[1] + "%," + color[2] + "%," + color[3] + ")";
					colorEl.css("background-color", hsla);
				}
			}*/

		</script>
		<style>

			.colorPicker {
				width: 768px;
			}
			.colorPicker .line {
				overflow: hidden;
			}
			.colorPicker .line-1 {
				margin-top: 10px;
			}
			.colorPicker .color {
				width: 44px;
				height: 44px;
				border-radius: 22px;
				margin: 4px;
				float: left;
			}

			.colorPicker {
				border: 1px solid red;
			}

			.colorPicker div.half {
				width: 23px;
				height: 44px;
				margin: 4px;
				float: left;
			}

			.colorPicker .line-0 .color.selected {
				background-image: url("donut.svg");
			}

			.colorPicker .line-1 .color.selected, .colorPicker .line-2 .color.selected {
				background-image: url("check-w.svg");
			}

		</style>
	</head>
	<body>
	</body>
	<div class="colorPicker">
	</div>
</html>